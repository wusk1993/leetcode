# 1.项目架构

项目分为4个模块

1.用户管理模块，基于rbac的用户管理模型，包括用户菜单权限和数据权限等控制

2.数据源和元数据管理模块，主要功能

​	1.管理数据源的连接信息 

​	2.抽取并管理数据源的元数据信息

3.数据分析引擎，主要功能

​	1.提供基于数据源的数据集模型的管理能力，实际上是建立表与表之间的连接关系，支持星形模型和雪花模型两种模型架构

​	2.提供数据集的多维度分析能力，包括数据的维度分析，过滤，排序，钻取等功能

​	3.提供跨数据源归集的能力

4.卡片管理模块，主要是保存可视化页面的卡片配置，数据导出，卡片分享的一系列功能

# 2.项目难点和优化

1.项目中遇到的问题

问题：大数据量或者数据集连接关系建立不当的时候，表格的查询性能急速下降

解决方法：

​	1.索引优化，在数仓层面优化性能，对于可预见的报表类型，在数仓层面根据数据模型建立合适的索引，优化查询性能，比如在经常需要过滤和聚合的字段上建立索引，例如统计省份下每个城市的在职人数，那么可以在人员信息表中建立省份列和城市列的联合索引，在联合查询的时候确保在on子句上的列上有索引

​	2.默认隐藏页码，连接关系建立不当时，查询连接总数据数需要耗费大量的时间，测试mysql官方的employee库，机器配置8核心32G内存，两张表关联查询总计数280万，查询耗时约为3.8s，单维度聚合后查询总记录数30万，查询时间约为5.1s，所以在图表展示查询的时候默认关闭了图表的总页数，总记录数查询，只保留当前页码和上下翻页的按钮，降低响应时间

​	3.深度分页优化，mysql的分页逻辑是读取偏移量条数据然后丢弃，再读取后面真正想要的数据，所以页码越大，偏移量越大，查询性能就越差，基于此可以利用主键索引或者是覆盖索引，先查询偏移量对应的索引列的值，再根据索引列的值

​	4.尽量减少join表的数量，这是基于模型建立时候的连接关系确定的，模型连接时会有一张中心表，称为事实表，是分析的维度数据，其他关联表称为维度表，是明细数据各个维度的信息，整体的模型结构可以看做是一颗N叉树，而且从N叉树的根节点向下，只能做左连接和内连接，为的是确保事实表中有的数据才能展示在图表中，所以在我们选择分析字段时，可以先判断字段路径所在的最先的树集合，只查询这几个表，不用查询整个模型的所有表，减少join表的数量

2.缓存设置

对于有一些场景，数据周期从业务库抽取到数仓库，再进行统计分析，针对这些场景的优化可以利用缓存来提高查询性能。缓存是以数据集为单位的，缓存有效期内相同的sql语句，先查询缓存，缓存中没有再查询数据库

